# Stopping Bahmni...
bahmni -i prod stop >/dev/null 2>&1
# Bahmni Stopped

# Taking Database Dump for the Primary Server...
bahmni -i prod backup --backup_type=db --options=openmrs >/dev/null 2>&1
# Database backup phase completed

# Taking incremental backup for bahmni...
mkdir -p /home/backup/incremental_home_bahmni/
rsync -avl  /home/bahmni/ /home/backup/incremental_home_bahmni/ >/dev/null 2>&1
# Incremental backup completed

# Taking backup of current inventory file and setup.yml...
cp /etc/bahmni-installer/prod /home/backup/release_version/local
cp /etc/bahmni-installer/setup.yml /home/backup/release_version/setup.yml
# Done

# Taking Database dump for bahmni-mart and metabase...
mkdir -p /data/bahmni-mart
# Enter analytics password :
pg_dump -U analytics analytics | gzip > /data/bahmni-mart/release_version-analytics.gz
# Enter metabase password :
pg_dump -U analytics metabase | gzip > /data/bahmni-mart/release_version-metabase.gz
# Done

# Taking pg_hba and bahmni-mart back up...
mkdir -p /home/backup/release_version/bahmni-mart-backup
cp /var/lib/pgsql/9.2/data/pg_hba.conf /home/backup/release_version/bahmni-mart-backup/.
cp -R /opt/bahmni-mart /home/backup/release_version/bahmni-mart-backup/
# Done

# Taking backup for bahmni-mart inventories and setup.yml...
cp /etc/bahmni-mart-playbook/inventories/bahmni-mart /home/backup/release_version/bahmni-mart-backup/bahmni-mart-inventory
cp /etc/bahmni-mart-playbook/setup.yml /home/backup/release_version/bahmni-mart-backup/.
# Done

# nagios folder incremental backup started...
mkdir -p /home/backup/release_version/nagios
rsync --ignore-existing -avl --recursive /etc/nagios/ /home/backup/release_version/nagios >/dev/null 2>&1
# nagios folder incremental backup completed

# Taking backup of ssl.conf...
cp /etc/httpd/conf.d/ssl.conf /home/backup/release_version/ssl.conf

# Listing latest backups...
ls -lrt /home/backup/release_version

# Listing latest openmrs database dump...
ls -Art /data/openmrs/ | tail -n 1